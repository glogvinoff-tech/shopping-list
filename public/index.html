<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h1>
        
        <div class="add-item">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h2>
            <input type="text" id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
            <input type="number" id="itemQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="1" min="1">
            <button onclick="addItem()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        
        <div class="filters">
            <h2>–§–∏–ª—å—Ç—Ä—ã</h2>
            <button onclick="loadItems()">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
            <button onclick="loadItems('true')">–ö—É–ø–ª–µ–Ω–Ω—ã–µ</button>
            <button onclick="loadItems('false')">–ù–µ –∫—É–ø–ª–µ–Ω–Ω—ã–µ</button>
        </div>
        
        <div class="items-list">
            <h2>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
            <div id="itemsContainer">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>
    
    <script>
        async function loadItems(purchased = null) {
            let url = '/api/items';
            if (purchased !== null) {
                url += `?purchased=${purchased}`;
            }
            
            try {
                const response = await fetch(url);
                const items = await response.json();
                displayItems(items);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }
        
        function displayItems(items) {
            const container = document.getElementById('itemsContainer');
            
            if (items.length === 0) {
                container.innerHTML = '<p>–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
                return;
            }
            
            container.innerHTML = items.map(item => `
                <div class="item ${item.purchased ? 'purchased' : ''}">
                    <h3>${item.name}</h3>
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${item.quantity}</p>
                    <p>–°—Ç–∞—Ç—É—Å: ${item.purchased ? '‚úÖ –ö—É–ø–ª–µ–Ω' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç'}</p>
                    <div class="actions">
                        <button onclick="togglePurchase(${item.id}, ${!item.purchased})">
                            ${item.purchased ? '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ –∫—É–ø–ª–µ–Ω–Ω–æ–µ' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∫—É–ø–ª–µ–Ω–Ω–æ–µ'}
                        </button>
                        <button onclick="updateItem(${item.id})" class="edit">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button onclick="deleteItem(${item.id})" class="delete">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }
        
        async function addItem() {
            const name = document.getElementById('itemName').value;
            const quantity = document.getElementById('itemQuantity').value;
            
            if (!name || !quantity) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            try {
                const response = await fetch('/api/items', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, quantity })
                });
                
                if (response.ok) {
                    document.getElementById('itemName').value = '';
                    document.getElementById('itemQuantity').value = '1';
                    loadItems();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }
        
        async function togglePurchase(id, purchased) {
            try {
                const response = await fetch(`/api/items/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ purchased })
                });
                
                if (response.ok) {
                    loadItems();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }
        
        async function updateItem(id) {
            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:');
            const newQuantity = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:');
            
            if (newName && newQuantity) {
                try {
                    const response = await fetch(`/api/items/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            name: newName, 
                            quantity: parseInt(newQuantity) 
                        })
                    });
                    
                    if (response.ok) {
                        loadItems();
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞:', error);
                }
            }
        }
        
        async function deleteItem(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
                try {
                    const response = await fetch(`/api/items/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadItems();
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞:', error);
                }
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadItems);
    </script>
</body>
</html>